=== Tomatillo Design AVIF Everywhere ===
Contributors: tomatillo-design
Requires at least: 6.1
Tested up to: 6.8
Requires PHP: 7.4
Stable tag: 1.0
License: GPLv2 or later
License URI: https://www.gnu.org/licenses/gpl-2.0.html
Tags: media, image optimization, avif, performance, uploads

A developer-focused plugin that converts uploaded JPEG and PNG images to optimized AVIF format, applies them across the Media Library and editor interfaces, and includes smart fallbacks and UI enhancements for a modern WordPress experience.

== Description ==

**Tomatillo Design AVIF Everywhere** is a lightweight, developer-minded plugin that automatically converts images in your Media Library to the next-gen AVIF format. It improves site performance and media workflows while staying out of your way.

Behind the scenes, it uses the best available methods (Imagick or `avifenc`) to generate modern AVIF versions of your JPEG and PNG uploads, including batch support for older images. Thumbnails in the Media Library are enhanced to display AVIF images where available, with visual fixes for layout, scaling, and transparency.

Smart fallbacks ensure only valid AVIFs are used — no broken images, no console errors. The plugin also gracefully replaces thumbnails in modal views like the Media Inserter (used when editing posts and pages).

== Features ==

- Converts JPEG and PNG uploads into AVIF format
- Automatically runs on original or scaled versions depending on mode
- AVIF thumbnails displayed in the Media Library and media modals
- Transparent PNGs are preserved using `avifenc` (if available)
- Graceful fallback to original formats if AVIF is unavailable or oversized
- Batch conversion support (manual trigger or cron-compatible)
- Media Library grid layout enhancements for clarity and usability
- Rate-limited checks to avoid overloading hosting environments

== How It Works ==

When an image is uploaded to your Media Library, the plugin schedules a short delay and then converts the image to AVIF using either:

- PHP's Imagick extension (if AVIF is supported), or
- the `avifenc` command-line tool for lossless conversion (especially for PNGs with transparency)

The plugin automatically compares the resulting AVIF size against WordPress’s scaled JPEG to ensure meaningful savings. If the AVIF is larger, it’s skipped.

Media thumbnails and editor modals are updated on the fly to load AVIF images — but only after verifying the file exists on the server. This avoids unnecessary 404 errors and keeps your browser console clean. The Media Library layout is adjusted using lightweight CSS for a more fluid, readable grid.

== When You Deactivate or Delete ==

Disabling or deleting the plugin will:
- Stop automatic AVIF generation for new uploads
- Revert the Media Library and modal views to their default JPEG/PNG appearance

However, any `.avif` files already generated by the plugin **will remain** on your server. They are safe to leave in place, but if desired, you may manually remove them from the `/wp-content/uploads/` directory.

== Requirements ==

- WordPress 6.1 or higher
- PHP 7.4 or higher
- Imagick PHP extension with AVIF support **or** access to the `avifenc` CLI tool

== Frequently Asked Questions ==

= Does this plugin replace the original images? =
No. It generates `.avif` versions alongside your originals. The originals remain untouched.

= Will it work without Imagick or `avifenc`? =
No. At least one of these is required. The plugin will gracefully exit without generating AVIFs if neither is available.

= Does it modify image URLs in content or templates? =
Yes — on the front end, the plugin dynamically replaces standard `<img>` tags with `<picture>` elements that include AVIF `<source>` tags (when supported by the browser and when valid AVIF files exist).

This helps reduce page weight and improve performance without requiring changes to your theme or post content. However, this may have side effects if:

- Your theme or builder relies on specific image markup for styling or JavaScript behavior
- External caching layers (like CDNs or aggressive page caches) store old image markup
- Lazy-loading, gallery, or lightbox plugins conflict with the new structure

If you experience unexpected behavior, you can disable this behavior by removing or overriding the plugin’s front-end script responsible for the AVIF injection, or by filtering its behavior using a custom hook.

= Can I batch-convert older uploads? =
Yes, batch conversion support is included and can be triggered manually or extended via custom cron jobs.

== Screenshots ==
1. Media Library with AVIF thumbnails and masonry layout
2. Media inserter modal showing AVIF previews in the post editor

== Changelog ==

= 1.0 =
* Initial release
* AVIF generation on upload
* Transparent PNG support with fallback
* Media Library and modal AVIF preview
* Dynamic layout improvements
* Throttled file existence checks to avoid rate limiting

== Upgrade Notice ==

= 1.0 =
First release. If you're upgrading from an internal build or beta version, you may want to manually clear any temporary `.avif.temp` files.
